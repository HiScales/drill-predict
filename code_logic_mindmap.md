# 工程地质钻探点智能预测系统 - 代码逻辑思维导图

## 🎯 系统目标
- **输入**：场地边界、建筑物分布、间距约束
- **输出**：最优钻探点布局
- **目标**：在满足工程约束的前提下，最大化地质信息获取效率

## 📁 数据层 (Data Layer)

### 10.1块
```
read_project_xlsx()
├── Site Sheet → 场地边界坐标
├── Building Sheet → 建筑物坐标+分组
├── Drill Sheet → 真实钻探点(验证用)
└── Spacing Sheet → 间距约束最小,最大]
```

### 1.2预处理模块
```
read_all_projects()
├── 批量读取所有项目文件
├── 按项目ID排序
└── 异常处理与日志记录
```

## 🔧 几何处理层 (Geometry Layer)

### 2.1几何对象构建
```
get_polygons()
├── 场地多边形构建
├── 建筑物多边形构建(按Group分组)
└── 几何有效性验证
```

###2.0.2取
```
get_building_keypoints_and_edges()
├── 建筑物角点提取
├── 建筑物边线采样
└── 特征点坐标标准化
```

### 2.3 场地分析
```
calculate_site_orientation()
├── 边界边向量计算
├── 加权平均角度计算
└── 主方向确定(用于网格对齐)
```

## 🧠 核心算法层 (Algorithm Layer)

###3.1能网格布点算法
```
select_uniform_grid_points_with_priority()
├── 第一步：建筑物特征点收集
│   ├── 角点强制选择
│   └── 边中点强制选择
├── 第二步：均匀网格生成
│   ├── 旋转网格生成
│   ├── 候选点过滤
│   └── 间距约束检查
└── 第三步：智能补充
    ├── 距离排序(优先稀疏区域)
    ├── 间距验证
    └── 最终点集确定
```

### 3.2 网格生成策略
```
generate_rotated_grid()
├── 边界框计算
├── 旋转变换应用
├── 网格点生成
├── 场地内点过滤
└── 中点动态补充
```

###3.0.3 点选择策略
```
优先级系统：
1⃣ 建筑物角点 (最高优先级)
   └── 地质条件变化关键区域
2⃣ 建筑物边中点 (高优先级)
   └── 建筑物周边过渡区域
3⃣ 均匀网格点 (标准优先级)
   └── 场地内部均匀覆盖
```

## 🔍 验证与优化层 (Validation Layer)

### 4.1 间距验证
```
validate_final_spacing()
├── 最小间距检查
├── 最大间距检查
└── 违规点对统计
```

### 4.2吸附优化
```
snap_point_to_building_features()
├── 角点吸附(优先级最高)
├── 边线吸附(次优先级)
└── 距离阈值控制
```

## 📊 输出与可视化层 (Output Layer)

###5.1结果保存
```
save_pred_to_excel()
├── 预测点坐标导出
├── Excel格式标准化
└── 文件命名规范
```

### 52 可视化分析
```
plot_drills()
├── 场地边界绘制
├── 建筑物轮廓绘制
├── 真实钻探点标记
├── 预测钻探点标记
└── 图例与标题
```

###50.3 性能分析
```
精度评估指标：
├── 平均距离误差
├── 最大距离误差
├── 最小距离误差
├── 点数量对比
└── 坐标范围对比
```

## 🚀 执行流程 (Execution Flow)

### 6.1 主程序流程
```
main()
├── 项目列表获取
├── 循环处理每个项目
│   ├── 数据读取
│   ├── 几何构建
│   ├── 算法执行
│   ├── 结果保存
│   └── 可视化生成
├── 汇总报告生成
└── 异常处理
```

### 62 算法执行时序
```
时间线：
T1: 数据读取 (5%)
T2 几何处理 (10)
T3: 特征点选择 (15%)
T4: 网格生成 (30
T5: 点筛选与补充 (25%)
T6: 结果输出 (15%)
```

## 🎯 算法优势

###7.1 智能性
- ✅ 自适应场地方向
- ✅ 优先级驱动选择
- ✅ 动态间距优化

### 7.2鲁棒性
- ✅ 异常数据容错
- ✅ 几何有效性验证
- ✅ 约束条件严格检查

### 7.3效率性
- ✅ 批量处理能力
- ✅ 算法复杂度优化
- ✅ 内存使用控制

## 🔧 技术栈

### 8.1 核心库
```
- pandas: 数据处理
- numpy: 数值计算
- shapely: 几何计算
- matplotlib: 可视化
- sklearn: 机器学习(预留)
```

###80.2 算法特点
```
- 几何驱动算法
- 约束满足优化
- 多目标平衡
- 实时验证机制
```

## 📈 应用场景

### 9.1 工程地质
- 场地勘察规划
- 钻探方案设计
- 地质风险评估

### 9.2规划
- 地下空间探测
- 基础设施规划
- 环境评估

### 93建筑项目
- 地基勘察
- 结构设计支持
- 施工安全评估
``` 